import{r as w,y as S,E as C,b as L,d as O,k as T,o as E,t as V,v as h,p as i,w as u,q as m}from"./index.e60cff6b.js";/* empty css                   *//* empty css                        */import"./http.5113bb0c.js";const z={style:{width:"100%",height:"100%",position:"relative"}},F=h("div",{style:{width:"100%",height:"100%"},id:"map"},null,-1),k={style:{position:"absolute",top:"0px",right:"0px","z-index":"999",padding:"5px"}},X={__name:"map",setup(B){let e=null,p,y,c;w([]);const v=w([]),g=w(!1),f=()=>{var t=new ol.interaction.Draw({type:"LineString"});e.addInteraction(t);var n=new ol.Overlay.Tooltip;e.addOverlay(n),t.on("drawstart",n.setFeature.bind(n)),t.on(["change:active","drawend"],function(l){n.removeFeature(l),e.removeInteraction(t)})},b=()=>{var t=new ol.interaction.Draw({type:"Polygon"});e.addInteraction(t);var n=new ol.Overlay.Tooltip;e.addOverlay(n),t.on("drawstart",n.setFeature.bind(n)),t.on(["change:active","drawend"],function(l){n.removeFeature(l),e.removeInteraction(t)})},_=()=>{e.once("rendercomplete",function(){const t=document.createElement("canvas"),n=e.getSize();t.width=n[0],t.height=n[1];const l=t.getContext("2d");Array.prototype.forEach.call(document.querySelectorAll(".ol-layer canvas"),function(o){if(o.width>0){const a=o.parentNode.style.opacity;l.globalAlpha=a===""?1:Number(a);const r=o.style.transform.match(/^matrix\(([^\(]*)\)$/)[1].split(",").map(Number);CanvasRenderingContext2D.prototype.setTransform.apply(l,r),l.drawImage(o,0,0)}}),navigator.msSaveBlob?navigator.msSaveBlob(t.msToBlob(),"map.png"):t.toBlob(function(o){const a=document.createElement("a");a.href=URL.createObjectURL(o),a.download="map.png",a.click()})}),e.renderSync()},x=()=>{const t=new ol.interaction.Draw({type:"Circle",geometryFunction:ol.interaction.Draw.createBox()});e.addInteraction(t),t.on("drawend",async function(n){const l=n.feature.getGeometry().getExtent(),o=c.getFeaturesInExtent(l);console.log(o),o.length>0&&e.getView().fit(l),v.value=o.map(a=>({\u540D\u79F0:a.get("\u540D\u79F0"),\u533A\u5212\u7801:a.get("\u533A\u5212\u7801"),\u53BF\u7EA7:a.get("\u53BF\u7EA7"),\u5730\u7EA7:a.get("\u5730\u7EA7"),\u7701\u7EA7:a.get("\u7701\u7EA7"),\u5761\u5EA6:a.get("\u5761\u5EA6"),\u9178\u78B1\u5EA6:a.get("\u9178\u78B1\u5EA6"),\u6709\u673A\u8D28:a.get("\u6709\u673A\u8D28"),\u5730\u529B:a.get("\u5730\u529B"),\u8015\u5730\u9762\u79EF:a.get("\u8015\u5730\u9762\u79EF")})),g.value=!0,e.removeInteraction(t)})};return S(()=>{e=new ol.Map({target:"map",layers:[new ol.layer.Tile({title:"\u9AD8\u5FB7\u5730\u56FE",source:new ol.source.XYZ({url:"https://webst01.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",crossOrigin:"anonymous"})}),new ol.layer.Tile({title:"\u9AD8\u5FB7\u5730\u56FE\u6807\u6CE8",source:new ol.source.XYZ({url:"https://webst01.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}",crossOrigin:"anonymous"})})],view:new ol.View({center:ol.proj.fromLonLat([113.2644,23.1291]),zoom:12,maxZoom:18})}),c=new ol.source.Vector({format:new ol.format.GeoJSON,url:"http://localhost:8000/getfarmlands",crossOrigin:"anonymous"});const t=new ol.layer.Vector({source:c,title:"\u8015\u5730\u6570\u636E",style:function(r){return new ol.style.Style({stroke:new ol.style.Stroke({color:"yellow",width:2}),fill:new ol.style.Fill({color:"rgba(255, 255, 0, 0.1)"})})}});e.addLayer(t);var n=new ol.layer.Tile({title:"DEM",visible:!1,source:new ol.source.XYZ({url:"http://localhost:8000/dem/{z}/{x}/{y}.png",crossOrigin:"anonymous"})});e.addLayer(n);var l=new ol.layer.Tile({title:"NDVI",visible:!1,source:new ol.source.XYZ({url:"http://localhost:8000/ndvi/{z}/{x}/{y}.png",crossOrigin:"anonymous"})});e.addLayer(l);var o=new ol.layer.Tile({title:"\u8015\u5730\u5730\u529B\u8BC4\u4EF7",visible:!1,source:new ol.source.XYZ({url:"http://localhost:8000/evaluation/{z}/{x}/{y}.png",crossOrigin:"anonymous"})});e.addLayer(o);var a=new ol.layer.Tile({title:"\u571F\u5730\u5229\u7528\u7C7B\u578B",visible:!1,source:new ol.source.XYZ({url:"http://localhost:8000/type/{z}/{x}/{y}.png",crossOrigin:"anonymous"})});e.addLayer(a),c.once("change",function(r){c.getState()==="ready"&&e.getView().fit(c.getExtent())}),e.addControl(new ol.control.LayerPopup),p=new ol.interaction.Select({hitTolerance:5,condition:ol.events.condition.singleClick,layers:[t]}),e.addInteraction(p),y=new ol.Overlay.PopupFeature({popupClass:"default anim",select:p,canFix:!1}),e.addOverlay(y),p.on("select",function(r){r.selected[0]});var s=new ol.control.SearchFeature({source:c,property:"\u540D\u79F0",sort:function(r,d){return s.getSearchString(r)<s.getSearchString(d)?-1:s.getSearchString(r)>s.getSearchString(d)?1:0}});e.addControl(s),s.on("select",function(r){console.log(r),p.getFeatures().clear(),p.getFeatures().push(r.search);var d=r.search.getGeometry().getFirstCoordinate();y.show(d,r.search),e.getView().animate({center:d})}),document.getElementsByClassName("search")[0].placeholder="\u8BF7\u8F93\u5165\u540D\u79F0"}),(t,n)=>{const l=C,o=L,a=O,s=T;return E(),V("div",z,[F,h("div",k,[i(l,{onClick:f},{default:u(()=>[m("\u8DDD\u79BB\u91CF\u7B97")]),_:1}),i(l,{onClick:b},{default:u(()=>[m("\u9762\u79EF\u91CF\u7B97")]),_:1}),i(l,{onClick:_},{default:u(()=>[m("\u5BFC\u51FA\u5730\u56FE")]),_:1}),i(l,{onClick:x},{default:u(()=>[m("\u7A7A\u95F4\u67E5\u8BE2")]),_:1})]),i(s,{modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=r=>g.value=r),title:"\u67E5\u8BE2\u7ED3\u679C"},{default:u(()=>[i(a,{data:v.value},{default:u(()=>[i(o,{prop:"\u540D\u79F0",label:"\u540D\u79F0"}),i(o,{prop:"\u53BF\u7EA7",label:"\u53BF\u7EA7"}),i(o,{prop:"\u5730\u7EA7",label:"\u5730\u7EA7"}),i(o,{prop:"\u5761\u5EA6",label:"\u5761\u5EA6"}),i(o,{prop:"\u9178\u78B1\u5EA6",label:"\u9178\u78B1\u5EA6"}),i(o,{prop:"\u6709\u673A\u8D28",label:"\u6709\u673A\u8D28"}),i(o,{prop:"\u5730\u529B",label:"\u5730\u529B"}),i(o,{prop:"\u8015\u5730\u9762\u79EF",label:"\u8015\u5730\u9762\u79EF"})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}};export{X as default};
